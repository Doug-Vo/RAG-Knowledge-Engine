<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Document Workbench</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        /* Style for the active tab button */
        .tab-button.active { 
            border-color: #3b82f6; /* blue-500 */
            color: #3b82f6; 
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 md:p-8 max-w-4xl">
        <div class="bg-white rounded-lg shadow-xl p-6 md:p-8">
            
            <div class="text-center mb-6">
                <h1 class="text-4xl font-bold text-gray-800">AI Document Workbench</h1>
                <p class="text-gray-500 mt-2">Interact with your documents using advanced AI.</p>
                
                <a href="https://github.com/Doug-Vo" target="_blank" class="inline-flex items-center mt-3 text-gray-600 hover:text-gray-900 transition-colors">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path>
                    </svg>
                    <span class="text-sm font-medium">Created by Doug-Vo</span>
                </a>
            </div>

            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    <div class="mb-6 space-y-2">
                    {% for category, message in messages %}
                        <div class="p-4 rounded-md text-sm font-semibold
                            {% if category == 'success' %} bg-green-100 text-green-800
                            {% elif category == 'error' %} bg-red-100 text-red-800
                            {% else %} bg-yellow-100 text-yellow-800 {% endif %}">
                            {{ message }}
                        </div>
                    {% endfor %}
                    </div>
                {% endif %}
            {% endwith %}

            <div class="mb-6 border-b border-gray-200">
                <nav class="flex space-x-4" aria-label="Tabs">
                    <button id="tab-about" 
                        class="tab-button {% if active_tab == 'about' %}active{% endif %} text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg">
                        About & Info
                    </button>
                    <button id="tab-query" 
                        class="tab-button {% if active_tab == 'query' %}active{% endif %} text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg">
                        Ask a Question
                    </button>
                    <button id="tab-ingest" 
                        class="tab-button {% if active_tab == 'ingest' %}active{% endif %} text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-lg">
                        Add Knowledge
                    </button>
                </nav>
            </div>

            <div>
                <div id="pane-about" class="{% if active_tab != 'about' %}hidden{% endif %}">
                    <div class="space-y-6 text-gray-700">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-2">Welcome to the AI Document Workbench</h2>
                            <p class="leading-relaxed">
                                This tool allows you to "chat" with your documents. Instead of relying solely on general knowledge, this AI looks up specific information from the files and links you provide to give you accurate, sourced answers.
                            </p>
                        </div>

                        <hr class="border-gray-200">

                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">How it Works (RAG)</h3>
                            <p class="mb-4">
                                This application uses a technique called <strong>Retrieval-Augmented Generation (RAG)</strong>. Here is the process:
                            </p>
                            <ol class="list-decimal list-inside space-y-2 ml-2">
                                <li><strong>Ingestion:</strong> When you upload a PDF or link, we split the text into small "chunks".</li>
                                <li><strong>Embedding:</strong> We convert these chunks into numerical vectors (lists of numbers) that represent their meaning.</li>
                                <li><strong>Retrieval:</strong> When you ask a question, we search the database for the chunks most similar to your query.</li>
                                <li><strong>Generation:</strong> We send your question + the relevant chunks to the AI model, which writes an answer based <em>only</em> on that information.</li>
                            </ol>
                        </div>

                        <hr class="border-gray-200">

                        <div>
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">Cloud Architecture</h3>
                            <div class="grid md:grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-4 rounded border border-gray-200">
                                    <div class="flex items-center mb-2">
                                        <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                                        <h4 class="font-bold text-gray-800">Docker Containerization</h4>
                                    </div>
                                    <p class="text-sm">
                                        The application is fully containerized using <strong>Docker</strong>. This ensures consistent performance across different environments by packaging the Python runtime, system dependencies, and application code into a single, lightweight image.
                                    </p>
                                </div>
                                <div class="bg-gray-50 p-4 rounded border border-gray-200">
                                    <div class="flex items-center mb-2">
                                        <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z"></path></svg>
                                        <h4 class="font-bold text-gray-800">Azure Deployment</h4>
                                    </div>
                                    <p class="text-sm">
                                        The live site is hosted on <strong>Microsoft Azure App Service</strong>. The Docker image is pushed to a private Azure Container Registry (ACR), and the web app pulls and runs the latest version automatically.
                                    </p>
                                </div>
                            </div>
                        </div>

                        <hr class="border-gray-200">

                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h3 class="text-xl font-semibold text-blue-800 mb-3">Knowledge Base Status</h3>
                            <div class="mb-4">
                                <h4 class="font-bold text-blue-900">üìö Permanent Documents (Always Available):</h4>
                                <ul class="list-disc list-inside text-sm text-blue-800 mt-1 ml-2 space-y-1">
                                    <li><a href="https://support.apple.com/en-us/100299" target="_blank" class="underline hover:text-blue-600">Iphone Battery Safety [PDF]</a></li>
                                    <li><a href="https://www.youtube.com/watch?v=4b4MUYve_U8" target="_blank" class="underline hover:text-blue-600">Stanford CS229: Machine Learning - Linear Regression (Lecture 2) [Video]</a></li>
                                    <li><a href="https://en.wikipedia.org/wiki/Aalto_University" target="_blank" class="underline hover:text-blue-600">Aalto University [Wiki]</a></li>
                                    <li><a href="https://en.wikipedia.org/wiki/University_of_Helsinki" target="_blank" class="underline hover:text-blue-600">University of Helsinki [Wiki]</a></li>
                                    <li><a href="https://en.wikipedia.org/wiki/University_of_Oulu" target="_blank" class="underline hover:text-blue-600">University of Oulu [Wiki]</a></li>
                                    <li><a href="https://en.wikipedia.org/wiki/Donald_Trump" target="_blank" class="underline hover:text-blue-600">Donald Trump [Wiki]</a></li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-blue-900">‚è≥ Your Uploads (Temporary):</h4>
                                <p class="text-sm text-blue-800 mt-1 ml-2">
                                    Any document you add via the "Add Knowledge" tab is considered temporary. 
                                    To keep the database clean and efficient, <strong>user uploads are automatically deleted 1 hour after creation.</strong>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="pane-query" class="{% if active_tab != 'query' %}hidden{% endif %}">
                    <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6 rounded shadow-sm">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                <svg class="h-5 w-5 text-blue-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-blue-800">Verify the AI's Response</h3>
                                <div class="mt-2 text-sm text-blue-700">
                                    <p>
                                        When the model answers, always double-check the <strong>"Sources"</strong> listed below the message. 
                                        If the source text does not align with the answer, the response may be unreliable (hallucination).
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <form action="/" method="POST" class="space-y-6">
                        <div>
                            <label for="question" class="block text-sm font-medium text-gray-700">Your Question</label>
                            <input type="text" name="question" id="question" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-lg p-3" placeholder="e.g., Where is University of Oulu" value="{{ question or '' }}">
                        </div>
                        <div class="text-right">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg shadow-md">Query Knowledge</button>
                        </div>
                    </form>
                    
                    {% if answer %}
                    <div class="mt-8 pt-6 border-t">
                        <h3 class="text-xl font-semibold text-gray-800 mb-2">Answer:</h3>
                        <p class="text-gray-700 text-lg whitespace-pre-wrap">{{ answer }}</p>
                        
                        {% if source_documents %}
                        <div class="mt-4">
                            <h4 class="text-md font-semibold text-gray-600">Sources:</h4>
                            <ul class="list-disc list-inside text-sm text-gray-500 mt-1">
                                {% for source in source_documents %}
                                <li>{{ source }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>

                <div id="pane-ingest" class="{% if active_tab != 'ingest' %}hidden{% endif %}">
                    <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6">
                        <div class="flex">
                            <div class="ml-3">
                                <p class="text-sm text-yellow-700">
                                    <span class="font-bold">Note:</span> Documents uploaded here are temporary. They will be automatically deleted from the database <strong>1 hour</strong> after upload.
                                </p>
                            </div>
                        </div>
                    </div>

                    <form action="/ingest" method="POST" enctype="multipart/form-data" class="space-y-6">
                        <div>
                            <h3 class="text-lg font-medium text-gray-800">Upload a PDF File</h3>
                            <label for="pdf_file" class="block text-sm font-medium text-gray-500 mt-1">Select a file from your computer.</label>
                            <input type="file" name="pdf_file" id="pdf_file" class="mt-2 block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                        </div>
                        
                        <div class="relative"><div class="absolute inset-0 flex items-center"><div class="w-full border-t border-gray-300"></div></div><div class="relative flex justify-center text-sm"><span class="bg-white px-2 text-gray-500 font-semibold">OR</span></div></div>

                        <div>
                            <h3 class="text-lg font-medium text-gray-800">Ingest from a URL</h3>
                            <label for="source_url" class="block text-sm font-medium text-gray-500 mt-1">Enter a link to a web page or YouTube video.</label>
                            <input type="text" name="source_url" id="source_url" class="mt-2 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 text-lg p-3" placeholder="https://...">
                        </div>

                        <div class="pt-2 text-right">
                            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg shadow-md">Add to Knowledge Base</button>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Tab Switching Logic
        const tabAbout = document.getElementById('tab-about');
        const tabQuery = document.getElementById('tab-query');
        const tabIngest = document.getElementById('tab-ingest');

        const paneAbout = document.getElementById('pane-about');
        const paneQuery = document.getElementById('pane-query');
        const paneIngest = document.getElementById('pane-ingest');

        function switchTab(activeTab, activePane) {
            // Hide all panes
            paneAbout.classList.add('hidden');
            paneQuery.classList.add('hidden');
            paneIngest.classList.add('hidden');
            
            // Deactivate all tabs
            tabAbout.classList.remove('active');
            tabQuery.classList.remove('active');
            tabIngest.classList.remove('active');

            // Activate selected
            activePane.classList.remove('hidden');
            activeTab.classList.add('active');
        }

        tabAbout.addEventListener('click', () => switchTab(tabAbout, paneAbout));
        tabQuery.addEventListener('click', () => switchTab(tabQuery, paneQuery));
        tabIngest.addEventListener('click', () => switchTab(tabIngest, paneIngest));
    </script>
</body>
</html>